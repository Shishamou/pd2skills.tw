<!DOCTYPE html>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>技能說明產生器</title>
</head>
<style>
    p {
        margin: 0;
    }

    .block {
        display: block;
        margin: 12px 4px;
        font-size: 12px;
        line-height: 1.3;
    }

    .block > input,
    .block > textarea {
        box-sizing: border-box;
        width: 360px;
        padding: 4px 6px;
    }

    .block > textarea {
        height: 100px;
        resize: none;
    }
</style>
<body>

    <form>
        <div class="block">
            <p>基本說明</p>
            <p>
                <input type="button" value="變數" data-variable-for="desc_basic" data-text="##$multibasic{no};##">
                <input type="button" value="逗點" data-variable-for="desc_basic" data-text="，">
                <input type="button" value="句點" data-variable-for="desc_basic" data-text="。">
            </p>
            <textarea id="desc_basic"></textarea>
        </div>
        <div class="block">
            <p>王牌說明</p>
            <p>
                <input type="button" value="變數" data-variable-for="desc_pro" data-text="##$multipro{no};##">
                <input type="button" value="逗點" data-variable-for="desc_pro" data-text="，">
                <input type="button" value="句點" data-variable-for="desc_pro" data-text="。">
            </p>
            <textarea id="desc_pro"></textarea>
        </div>
        <input type="submit" value="產生">
    </form>

    <hr>
    <div class="block">
        <p>輸出</p>
        <textarea id="print"></textarea>
    </div>

    <script>
        var state = {};
        var elements = document.querySelectorAll('[data-variable-for]');
        Object.keys(elements).forEach(function(i) {
            var element = elements[i];
            var target = element.getAttribute('data-variable-for');
            var text = element.getAttribute('data-text');

            element.addEventListener('click', function(e) {
                var count = state[target] = state[target] + 1 || 1;
                if (1 == count) count = '';

                document.querySelector('#' + target).value += text.replace('{no}', count);
            });
        });

        var print = document.getElementById('print');
        document.forms[0].addEventListener('submit', function(e) {
            e.preventDefault();

            print.value =
                "基礎：##$basic;##\\n" +
                document.getElementById('desc_basic').value +
                "。\\n\\n" +
                "精通：##$pro;##\\n" +
                document.getElementById('desc_pro').value +
                "。";

            setTimeout(function() {
                print.focus();
                document.getElementById('desc_basic').value = '';
                document.getElementById('desc_pro').value = '';
                state = {};
            }, 100);
        });
    </script>
</script>
</body>
</html>
